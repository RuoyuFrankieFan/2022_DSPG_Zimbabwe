---
title: "Visualisations for NDVI"
author: "Frankie Fan"
date: '2022-06-17'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



```{r}
library(readxl)
library(dplyr)
library(tidyverse)
library(sf)
library(ggplot2)
library(rgdal)

library(ggsn)
library(ggspatial)
```

read in the files
```{r}
MPI_2011 <- read_excel("./Data/2011_MPI_source.xlsx")
MonthlyNDVI2011 <- read_csv("./Data/2011Monthly.csv")
AnnualNDVI <- read_csv("./Data/NDVI2000-2021.csv")
zim_district <- st_read("./Shapefiles/Zim_D60.shp")  
```

Rename cols to match
```{r}
zim_district <- rename(zim_district, District = NAME_2)
```


```{r}
zim_district <- zim_district %>% 
  select(District)

MonthlyNDVI2011 <- MonthlyNDVI2011 %>% 
  rename(Month = Year)
 
NDVI_district <-  full_join (zim_district, MonthlyNDVI2011, by = "District")
```


Mapping NDVI
```{r}

# LongMonthlyNDVI$Month <- str_replace(df$conference, "West", "Western")


NDVI_district$Month[which(NDVI_district$Month=="Jan")] <- "1"
NDVI_district$Month[which(NDVI_district$Month=="Feb")] <- "2"
NDVI_district$Month[which(NDVI_district$Month=="Mar")] <- "3"
NDVI_district$Month[which(NDVI_district$Month=="Apr")] <- "4"
NDVI_district$Month[which(NDVI_district$Month=="May")] <- "5"
NDVI_district$Month[which(NDVI_district$Month=="Jun")] <- "6"
NDVI_district$Month[which(NDVI_district$Month=="Jul")] <- "7"
NDVI_district$Month[which(NDVI_district$Month=="Aug")] <- "8"
NDVI_district$Month[which(NDVI_district$Month=="Sep")] <- "9"
NDVI_district$Month[which(NDVI_district$Month=="Oct")] <- "10"
NDVI_district$Month[which(NDVI_district$Month=="Nov")] <- "11"
NDVI_district$Month[which(NDVI_district$Month=="Dec")] <- "12"

NDVI_district$Month <- as.numeric(as.character(NDVI_district$Month))

# Average NDVI by month
AvgMonthlyNDVI <- NDVI_district %>% 
  filter(Type == "Average") %>% 
  arrange(Month) %>% 
  ggplot() +
  geom_sf(size = 1, color = "black", aes(fill = NDVI)) +
  coord_sf() +
  scale_fill_viridis_c(option = "G", direction = -1) +
  facet_wrap(~Month) +
  ggtitle("Average NDVI in Zimbabwe - 2011")
AvgMonthlyNDVI


# Maximum NDVI by month
MaxMonthlyNDVI <- NDVI_district %>% 
  filter(Type == "Max") %>% 
  arrange(Month) %>% 
  ggplot() +
  geom_sf(size = 1, color = "black", aes(fill = NDVI)) +
  coord_sf() +
  scale_fill_viridis_c(option = "G", direction = -1) +
  facet_wrap(~Month) +
  ggtitle("Max NDVI in Zimbabwe - 2011")
MaxMonthlyNDVI



jpeg(filename = "AvgMonthlyNDVI.jpeg", 
    res = 500,
     bg = "white")
AvgMonthlyNDVI
dev.off()


BySeasonAvg <- NDVI_district %>% 
  filter(Type == "Average") 

```

```{r}
# Annual NDVI

AnnualNDVI <- read_csv("./Data/NDVI2000-2021.csv")

AnnualNDVI %>% 
  ggplot(aes(x = Year, y=Precipitation, fill=Type)) +
  geom_bar(stat="identity", position=position_dodge()) +
  geom_smooth(color="#006000")+
  scale_fill_brewer(palette = "Set2")+
  labs(title = "NDVI, Year 2000-2021") +
    xlab("Year") +
    ylab("NDVI")
```


## Distribution of NDVI from 2011--2017
```{r}
NDVI_long <- read_csv("./Data/NDVI_long.csv") 
NDVI_long %>% 
  filter(Year == 2011:2017) %>% 
  ggplot(aes(x = Year, y = NDVI, fill = as.factor(Year))) + 
  geom_boxplot() +
  stat_summary(fun = "mean", geom = "point", shape = 8,
               size = 2, color = "white") +
  scale_fill_brewer(palette="Set2", name = "Year") +
  labs(title = "Distribution of NDVI in Zimbabwe, Year 2011-2017") 

```




## Distribution of NDVI in 2011 and 2017
```{r}
AnnualNDVI %>% 
  filter( Year == 2011|Year == 2017) %>% 
  ggplot(aes(x = Type, y = Precipitation)) + 
  facet_wrap(~Year)+
  geom_boxplot() +
  labs(title = "Distribution of NDVI, Year 2011 & 2017") +
    xlab("Statistics") +
    ylab("NDVI")

```

#### Description

This graphics shows the distribution of NDVI across 60 districts in 2011 and 2017. Compared to the statistics in 2011, there is a clear pattern of higher NDVI values in 2017. 



## Average NDVI March2011 & March2017 (Map)
```{r, visualization for March}
NDVI_monthly <- read_csv("./Data/NDVI_monthly.csv") 
NDVI_monthly_district <- full_join (zim_district, NDVI_monthly, by = "District")

AvgMarch2011 <- NDVI_monthly_district %>% 
  filter(Year == 2011, Month == "03") %>% 
  ggplot() +
  geom_sf(size = 1, color = "black", aes(fill = AverageNDVI)) +
  coord_sf() +
  scale_fill_viridis_c(option = "G", direction = -1) +
  ggtitle("Average NDVI in Zimbabwe - March 2011")
AvgMarch2011


AvgMarch <- NDVI_monthly_district %>% 
  filter(Year == 2011|Year == 2017, Month == "03") %>% 
  ggplot() +
  geom_sf(size = 1, color = "black", aes(fill = AverageNDVI)) +
  facet_wrap(~Year) +
  coord_sf() +
  scale_fill_viridis_c(option = "G", direction = -1) +
  ggtitle("Average NDVI in Zimbabwe - March")
AvgMarch
```
The above maps presents the change of NDVI values in year 2011 and 2017.

## Max NDVI March2011 & March2017 (Map)
```{r, visualization for March}
NDVI_monthly <- read_csv("./Data/NDVI_monthly.csv") 
NDVI_monthly_district <- full_join (zim_district, NDVI_monthly, by = "District")


MaxMarch <- NDVI_monthly_district %>% 
  filter(Year == 2011|Year == 2017, Month == "03") %>% 
  ggplot() +
  geom_sf(size = 1, color = "black", aes(fill = AverageNDVI)) +
  facet_wrap(~Year) +
  coord_sf() +
  scale_fill_viridis_c(option = "G", direction = -1) +
  ggtitle("Maximum NDVI in Zimbabwe - March")
MaxMarch
```



## Focusing on 2017 (Map by season)

```{r}
Season2017 <- NDVI_monthly_district %>% 
  filter(Year == 2016|Year == 2017, Month == "03"|Month == "10") %>% 
  filter(!(Year == 2016 & Month == "03"))

bySeason2017 <- Season2017 %>%
  unite("YM", Year:Month)

`2017Seg1` <- Season2017 %>% 
  filter(Year == 2016 & Month == "10") %>%
  ggplot() +
  geom_sf(size = 1, color = "black", aes(fill = AverageNDVI)) +
  coord_sf() +
  scale_fill_viridis_c(option = "G", direction = -1) +
  ggtitle("Average NDVI in Zimbabwe - 2017 Seg 1")

`2017Seg2` <- Season2017 %>% 
  filter(Year == 2017 & Month == "03") %>%
  ggplot() +
  geom_sf(size = 1, color = "black", aes(fill = AverageNDVI)) +
  coord_sf() +
  scale_fill_viridis_c(option = "G", direction = -1) +
  ggtitle("Average NDVI in Zimbabwe - 2017 Seg 2")

`2017Seg3` <- Season2017 %>% 
  filter(Year == 2017 & Month == "10") %>%
  ggplot() +
  geom_sf(size = 1, color = "black", aes(fill = AverageNDVI)) +
  coord_sf() +
  scale_fill_viridis_c(option = "G", direction = -1) +
  ggtitle("Average NDVI in Zimbabwe - 2017 Seg 3")


`2017Seg1`
`2017Seg2`
`2017Seg3`



```

