---
title: "Data Process Template- Monthly Precipitation Estimates"
author: "Frankie Fan + Josue Navarrete"
date: '2022-06-23'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(dplyr)
library(moderndive)
library(readr)
library(tidyr)
library(lubridate)
```
## Read in the files
```{r}
Precipitation_source <- read_csv("./PRECIP_ts_Zimb.csv")

```


## Goal: find the mean, max and min value for precipitation for each month

1. Drop some unessential columns [Not needed in the precipitation data]
```{r}
#This is in wide format
NDVI_wide <- Precipitation_source %>% 
  select(NAME_2, `3B43_20000312__Precipitation`:`2021_12_30_Precipitation`) %>% #select needed columns--Districts and observations
  rename(District = NAME_2) #rename column
```



////////////////////////////////////////////////////////////////////////////////////// 

Josue 2. Transform it to long format (Adapted from Frankie)
```{r}
# Parsed through the date with "_". Might need to change the code when it comes with different format
# Here the format for observation is yyyy_mm_dd_NDVI. Modify it if your observation comes with a different format.

Precipitation_long <- gather(Precipitation_source, Date, Precipitation, `3B43_20000301_7A_precipitation`:`3B43_20191201_7_precipitation`) %>% 
  select(NAME_2, Date, Precipitation) %>% 
  separate( col=Date, into=c('useless', 'Date','useless2', "Pre"), sep='_') %>% 
  select(-Pre, -useless,-useless2) #drop the _NDVI string segment

```


Josue 2A.Separate date col into year, month, & day col

```{r}
Precipitation_long$Date <- ymd(date_converted$Date)

Precipitation_long <- Precipitation_long %>% 
  select(Date, Precipitation, NAME_2 ) %>% 
  separate(col = Date, into = c("Year","Month","Day"))

Precipitation_long <- Precipitation_long  %>% rename(District = NAME_2)

```

Josue 3. Find the average, max, and min precipitation for annual level  
```{r}
PRECIP_annual <- Precipitation_long %>%
  select(-Month,-Day) %>% 
  group_by(District, Year) %>% 
  summarise(AveragePRECIP = mean(Precipitation, na.rm=TRUE),
            MaxPRECIP = max(Precipitation, na.rm=TRUE),
            MinPRECIP = min(Precipitation, na.rm=TRUE))
write.csv(PRECIP_annual, "./PRECIP_annual.csv", row.names = FALSE)

```


3. Find the average, max, and min precipitation for annual level
```{r}
NDVI_annual <- NDVI_long %>% 
  select(-Month, -Day) %>% 
  group_by(District, Year) %>%    # group by district and year
  summarise(AverageNDVI = mean(NDVI, na.rm=TRUE),   # Find the mean, max, min by district
         MaxNDVI = max(NDVI, na.rm=TRUE),
         MinNDVI = min(NDVI, na.rm=TRUE))   # could also find median, standard deviation, z-score if needed

write.csv(NDVI_annual,"./Data/NDVI_annual.csv", row.names = FALSE)


```

Josue 4. Monthly Data
```{r}
PRECIP_monthly <- Precipitation_long %>% 
  select(-Day) %>% 
  group_by(District, Year, Month) %>% 
  summarise(AveragePRECIP = mean(Precipitation, na.rm=TRUE),
            MaxPRECIP = max(Precipitation, na.rm=TRUE),
            MinPRECIP = min(Precipitation, na.rm = TRUE))

write.csv(PRECIP_monthly,"./PRECIP_monthly.csv", row.names = FALSE)
```

4. Monthly Data
```{r}
NDVI_monthly <- NDVI_long %>% 
  select(-Day) %>% 
  group_by(District, Year, Month) %>%   # Group by district, year and month
  summarise(AverageNDVI = mean(NDVI, na.rm=TRUE),   
         MaxNDVI = max(NDVI, na.rm=TRUE),
         MinNDVI = min(NDVI, na.rm=TRUE))

write.csv(NDVI_monthly,"./Data/NDVI_monthly.csv", row.names = FALSE)

```

Josue 5. Subset of Monthly Data- 2011-2017
```{r}
'PRECIP_monthly_2011-2019' <- PRECIP_monthly %>% 
  filter(Year == 2011:2017) %>% 
  arrange(Year, Month)

write.csv(PRECIP_monthly, "./PRECIP_monthly_2011-2017.csv", row.names = FALSE)
```




5. Subset of Monthly Data- 2011-2017
```{r}
`NDVI_monthly_2011-2017` <- NDVI_monthly %>% 
  filter(Year == 2011:2017) %>% 
  arrange(Year, Month)

write.csv(NDVI_monthly,"./Data/NDVI_monthly_2011-2017.csv", row.names = FALSE)
```

