
```{r setup}
knitr::opts_chunk$set(
    dev = "png",
    dpi = 300,
    echo = FALSE,
    cache = TRUE,
    colorize <- function(x, color) {
     if (knitr::is_latex_output()) {
      sprintf("\\textcolor{%s}{%s}", color, "\\textbf{x}", x)
     } else if (knitr::is_html_output()) {
       sprintf("<span style='color: %s;'>%s</span>", color, 
      x)
     } else x
   })
library(pastecs)
library(Hmisc)
library(MASS)
library(RColorBrewer)
library(openxlsx)  # Call the openxlsx library
library(stargazer)
library(dplyr)
library(moderndive)
library(readr)
library(tidyr)
library(lubridate)
library(stringr)
library(sf)
library(tidyverse)
library(zoo)
library(scales)
library(ggplot2)
library(viridis)
library(dotwhisker)
rm(list = ls())
#
# Create custom colorblind friendly colors
#
customvermilion <- rgb(213/255,94/255,0/255)
custombluegreen <- rgb(0/255,158/255,115/255)
customblue <- rgb(0/255,114/255,178/255)
customskyblue <- rgb(86/255,180/255,233/255)
customreddishpurple <- rgb(204/255,121/255,167/255)
customblack <- rgb(0/255,0/255,0/255)
customorange <- rgb(230/255,159/255,0/255)
customyellow <- rgb(240/255,228/255,66/255)
#
options(scipen=100)             # scipen > 0 ~> printout toward integers
options(digits=6)               # display 6 digits
```

```{r}
setwd("D:/Virginia Tech/Summer 2022/Project-Zimbabwe/")
```

```{r}
dataraw <- read_csv("./ZimDataReg_updated.csv")
datareg <- as.data.frame(dataraw) 
```


```{r}
model1a <- lm(m0_k3_adj ~ yeard + rainnovdec, data = datareg)
model2a <- lm(m0_k3_adj ~ yeard + rainnovjan, data = datareg)
model3a <- lm(m0_k3_adj ~ yeard + rainnovfeb, data = datareg)
model4a <- lm(m0_k3_adj ~ yeard + rainnovmar, data = datareg)
model5a <- lm(m0_k3_adj ~ yeard + rainnovapr, data = datareg)
model6a <- lm(m0_k3_adj ~ yeard + rainnovmay, data = datareg)

summary(model1a) 
summary(model2a)
summary(model3a)
summary(model4a)
summary(model5a)
summary(model6a)
```

```{r}
m1a_df <-
    broom::tidy(model1a) %>% filter(term != "yeard") %>% mutate(model = "Model 1A")
m2a_df <-
    broom::tidy(model2a) %>% filter(term != "yeard") %>% mutate(model = "Model 2A")
m3a_df <-
    broom::tidy(model3a) %>% filter(term != "yeard") %>% mutate(model = "Model 3A")
m4a_df <-
    broom::tidy(model4a) %>% filter(term != "yeard") %>% mutate(model = "Model 4A")
m5a_df <-
    broom::tidy(model5a) %>% filter(term != "yeard") %>% mutate(model = "Model 5A")
m6a_df <-
    broom::tidy(model6a) %>% filter(term != "yeard") %>% mutate(model = "Model 6A")

m0_models_a <- rbind(m1a_df, m2a_df, m3a_df, m4a_df, m5a_df, m6a_df)

```

```{r plot_pptm0adj}
#colorblind-friendly custom colors used here on
dwplot(m0_models_a, dodge_size = 0, dot_args = list(size = 5, color=customblue), whisker_args = list(size = 2, color=customblue),
       vline = geom_vline(
           xintercept = 0,
           colour = "grey6",
           linetype = 2
       ),
       vars_order = c("rainnovmay", "rainnovapr", "rainnovmar", "rainnovfeb", "rainnovjan", "rainnovdec"),
       model_order = c("Model 6A", "Model 5A", "Model 4A", "Model 3A", "Model 2A", "Model 1A")
       ) %>% # plot line at zero _behind_coefs
    relabel_predictors(
        c(
            rainnovmay = "Nov-May",
            rainnovapr = "Nov-Apr",
            rainnovmar = "Nov-Mar",
            rainnovfeb = "Nov-Feb",
            rainnovjan = "Nov-Jan",
            rainnovdec = "Nov-Dec"
        )
    ) + coord_flip() +
    # Setting `base_size` for fit the theme
    # No need to set `base_size` in most usage
    xlab("Coefficient Estimate") + ylab("Rainfall (100 mm)") +
    geom_vline(xintercept = 0,
               colour = "grey6",
               linetype = 2) +
    ggtitle("Fig. 1A: OLS Estimation Of Poverty Headcount Ratio, M0, (adjusted) Using Precipitation") + theme_bw() +
    theme(
          legend.position = "none", plot.title = element_text(size = 12)
    ) 


```


\vspace{0.1in}
Sensitivity Analysis:
\vspace{0.1in}
We conducted additional sensitivity analysis to check the robustness of our findings pertaining to the association between poverty measures and precipitation. Since literacy rate in Zimbabwe is quite high at 88.69 percent, and primary education completion rate is 89 percent, adjusted MPI measures were generated by replacing the "No Primary Education" component with a "No High School Education" component defined as no one in the household having completed high school. The regression coefficients using the adjusted MPI measures are presented in Figures 1A, 2A and 3A. When compared to Figures 1, 2 and 3, respectively, we observe that the overall trend is consistent. However, in some cases the associations between cumulative monthly rainfall and the adjusted MPI measures are slightly less significant. 
\vspace{0.1in}


```{r}
model7a <- lm(m1_k3_adj ~ yeard + rainnovdec, data = datareg)
model8a <- lm(m1_k3_adj ~ yeard + rainnovjan, data = datareg)
model9a <- lm(m1_k3_adj ~ yeard + rainnovfeb, data = datareg)
model10a <- lm(m1_k3_adj ~ yeard + rainnovmar, data = datareg)
model11a <- lm(m1_k3_adj ~ yeard + rainnovapr, data = datareg)
model12a <- lm(m1_k3_adj ~ yeard + rainnovmay, data = datareg)

summary(model7a) 
summary(model8a)
summary(model9a)
summary(model10a)
summary(model11a)
summary(model12a)
```

```{r}
m7a_df <-
    broom::tidy(model7a) %>% filter(term != "yeard") %>% mutate(model = "Model 7A")
m8a_df <-
    broom::tidy(model8a) %>% filter(term != "yeard") %>% mutate(model = "Model 8A")
m9a_df <-
    broom::tidy(model9a) %>% filter(term != "yeard") %>% mutate(model = "Model 9A")
m10a_df <-
    broom::tidy(model10a) %>% filter(term != "yeard") %>% mutate(model = "Model 10A")
m11a_df <-
    broom::tidy(model11a) %>% filter(term != "yeard") %>% mutate(model = "Model 11A")
m12a_df <-
    broom::tidy(model12a) %>% filter(term != "yeard") %>% mutate(model = "Model 12A")

m1_models_a <- rbind(m7a_df, m8a_df, m9a_df, m10a_df, m11a_df, m12a_df)

```


```{r plot_pptm1adj}
dwplot(m1_models_a, dodge_size = 0, dot_args = list(size = 5, color=customblue), whisker_args = list(size = 2, color=customblue),
       vline = geom_vline(
           xintercept = 0,
           colour = "grey6",
           linetype = 2
       ),
       vars_order = c("rainnovmay", "rainnovapr", "rainnovmar", "rainnovfeb", "rainnovjan", "rainnovdec"),
       model_order = c("Model 12A", "Model 11A", "Model 10A", "Model 9A", "Model 8A", "Model 7A")
       ) %>% # plot line at zero _behind_coefs
    relabel_predictors(
        c(
            rainnovmay = "Nov-May",
            rainnovapr = "Nov-Apr",
            rainnovmar = "Nov-Mar",
            rainnovfeb = "Nov-Feb",
            rainnovjan = "Nov-Jan",
            rainnovdec = "Nov-Dec"
        )
    ) + coord_flip() +
    # Setting `base_size` for fit the theme
    # No need to set `base_size` in most usage
    xlab("Coefficient Estimate") + ylab("Rainfall (100 mm)") +
    geom_vline(xintercept = 0,
               colour = "grey6",
               linetype = 2) +
    ggtitle("Fig. 2A: OLS Estimation Of Poverty Gap, M1, (adjusted) Using Precipitation") + theme_bw() +
    theme(
          legend.position = "none", plot.title = element_text(size = 12)
    ) 

```


```{r}
model13a <- lm(m2_k3_adj ~ yeard + rainnovdec, data = datareg)
model14a <- lm(m2_k3_adj ~ yeard + rainnovjan, data = datareg)
model15a <- lm(m2_k3_adj ~ yeard + rainnovfeb, data = datareg)
model16a <- lm(m2_k3_adj ~ yeard + rainnovmar, data = datareg)
model17a <- lm(m2_k3_adj ~ yeard + rainnovapr, data = datareg)
model18a <- lm(m2_k3_adj ~ yeard + rainnovmay, data = datareg)

summary(model13a) 
summary(model14a)
summary(model15a)
summary(model16a)
summary(model17a)
summary(model18a)
```

```{r}
m13a_df <-
    broom::tidy(model13a) %>% filter(term != "yeard") %>% mutate(model = "Model 13A")
m14a_df <-
    broom::tidy(model14a) %>% filter(term != "yeard") %>% mutate(model = "Model 14A")
m15a_df <-
    broom::tidy(model15a) %>% filter(term != "yeard") %>% mutate(model = "Model 15A")
m16a_df <-
    broom::tidy(model16a) %>% filter(term != "yeard") %>% mutate(model = "Model 16A")
m17a_df <-
    broom::tidy(model17a) %>% filter(term != "yeard") %>% mutate(model = "Model 17A")
m18a_df <-
    broom::tidy(model18a) %>% filter(term != "yeard") %>% mutate(model = "Model 18A")

m2_models_a <- rbind(m13a_df, m14a_df, m15a_df, m16a_df, m17a_df, m18a_df)

```


```{r plot_pptm2adj}
dwplot(m2_models_a, dodge_size = 0, dot_args = list(size = 5, color=customblue), whisker_args = list(size = 2, color=customblue),
       vline = geom_vline(
           xintercept = 0,
           colour = "grey6",
           linetype = 2
       ),
       vars_order = c("rainnovmay", "rainnovapr", "rainnovmar", "rainnovfeb", "rainnovjan", "rainnovdec"),
       model_order = c("Model 18A", "Model 17A", "Model 16A", "Model 15A", "Model 14A", "Model 13A")
       ) %>% # plot line at zero _behind_coefs
    relabel_predictors(
        c(
            rainnovmay = "Nov-May",
            rainnovapr = "Nov-Apr",
            rainnovmar = "Nov-Mar",
            rainnovfeb = "Nov-Feb",
            rainnovjan = "Nov-Jan",
            rainnovdec = "Nov-Dec"
        )
    ) + coord_flip() +
    # Setting `base_size` for fit the theme
    # No need to set `base_size` in most usage
    xlab("Coefficient Estimate") + ylab("Rainfall (100 mm)") +
    geom_vline(xintercept = 0,
               colour = "grey6",
               linetype = 2) +
    ggtitle("Fig. 3A: OLS Estimation Of Squared Poverty Gap, M2, (adjusted) Using Precipitation") + theme_bw() +
    theme(
          legend.position = "none", plot.title = element_text(size = 12)
    ) 

```





```{r}
model1b <- lm(m0_k3_adj_rural ~ yeard + rainnovdec, data = datareg)
model2b <- lm(m0_k3_adj_rural ~ yeard + rainnovjan, data = datareg)
model3b <- lm(m0_k3_adj_rural ~ yeard + rainnovfeb, data = datareg)
model4b <- lm(m0_k3_adj_rural ~ yeard + rainnovmar, data = datareg)
model5b <- lm(m0_k3_adj_rural ~ yeard + rainnovapr, data = datareg)
model6b <- lm(m0_k3_adj_rural ~ yeard + rainnovmay, data = datareg)

summary(model1b) 
summary(model2b)
summary(model3b)
summary(model4b)
summary(model5b)
summary(model6b)
```

```{r}
m1b_df <-
    broom::tidy(model1b) %>% filter(term != "yeard") %>% mutate(model = "Model 1B")
m2b_df <-
    broom::tidy(model2b) %>% filter(term != "yeard") %>% mutate(model = "Model 2B")
m3b_df <-
    broom::tidy(model3b) %>% filter(term != "yeard") %>% mutate(model = "Model 3B")
m4b_df <-
    broom::tidy(model4b) %>% filter(term != "yeard") %>% mutate(model = "Model 4B")
m5b_df <-
    broom::tidy(model5b) %>% filter(term != "yeard") %>% mutate(model = "Model 5B")
m6b_df <-
    broom::tidy(model6b) %>% filter(term != "yeard") %>% mutate(model = "Model 6B")

m0_models_b <- rbind(m1b_df, m2b_df, m3b_df, m4b_df, m5b_df, m6b_df)

```

```{r plot_pptm0adjr}
dwplot(m0_models_b, dodge_size = 0, dot_args = list(size = 5, color=customblue), whisker_args = list(size = 2, color=customblue),
       vline = geom_vline(
           xintercept = 0,
           colour = "grey6",
           linetype = 2
       ),
       vars_order = c("rainnovmay", "rainnovapr", "rainnovmar", "rainnovfeb", "rainnovjan", "rainnovdec"),
       model_order = c("Model 6B", "Model 5B", "Model 4B", "Model 3B", "Model 2B", "Model 1B")
       ) %>% # plot line at zero _behind_coefs
    relabel_predictors(
        c(
            rainnovmay = "Nov-May",
            rainnovapr = "Nov-Apr",
            rainnovmar = "Nov-Mar",
            rainnovfeb = "Nov-Feb",
            rainnovjan = "Nov-Jan",
            rainnovdec = "Nov-Dec"
        )
    ) + coord_flip() +
    # Setting `base_size` for fit the theme
    # No need to set `base_size` in most usage
    xlab("Coefficient Estimate") + ylab("Rainfall (100 mm)") +
    geom_vline(xintercept = 0,
               colour = "grey6",
               linetype = 2) +
    ggtitle("Fig. 1B: OLS Estimation Of Rural Poverty Headcount Ratio, M0, (adjusted) Using Precipitation") + theme_bw() +
    theme(
          legend.position = "none", plot.title = element_text(size = 11)
    ) 


```



\vspace{0.1in}
We also estimated the adjusted rural MPI measures that were calculated using only the sub-sample of rural households from PICES. The coefficient estimates from the regression models are presented in Figures 1B, 2B and 3B. Once again, our findings remain consistent - more rainfall is associated with lower rural poverty headcount, poverty gap, as well as squared poverty gap. 
\vspace{0.1in}

```{r}
model7b <- lm(m1_k3_adj_rural ~ yeard + rainnovdec, data = datareg)
model8b <- lm(m1_k3_adj_rural ~ yeard + rainnovjan, data = datareg)
model9b <- lm(m1_k3_adj_rural ~ yeard + rainnovfeb, data = datareg)
model10b <- lm(m1_k3_adj_rural ~ yeard + rainnovmar, data = datareg)
model11b <- lm(m1_k3_adj_rural ~ yeard + rainnovapr, data = datareg)
model12b <- lm(m1_k3_adj_rural ~ yeard + rainnovmay, data = datareg)

summary(model7b) 
summary(model8b)
summary(model9b)
summary(model10b)
summary(model11b)
summary(model12b)
```

```{r}
m7b_df <-
    broom::tidy(model7b) %>% filter(term != "yeard") %>% mutate(model = "Model 7B")
m8b_df <-
    broom::tidy(model8b) %>% filter(term != "yeard") %>% mutate(model = "Model 8B")
m9b_df <-
    broom::tidy(model9b) %>% filter(term != "yeard") %>% mutate(model = "Model 9B")
m10b_df <-
    broom::tidy(model10b) %>% filter(term != "yeard") %>% mutate(model = "Model 10B")
m11b_df <-
    broom::tidy(model11b) %>% filter(term != "yeard") %>% mutate(model = "Model 11B")
m12b_df <-
    broom::tidy(model12b) %>% filter(term != "yeard") %>% mutate(model = "Model 12B")

m1_models_b <- rbind(m7b_df, m8b_df, m9b_df, m10b_df, m11b_df, m12b_df)

```


```{r plot_pptm1adjr}
dwplot(m1_models_b, dodge_size = 0, dot_args = list(size = 5, color=customblue), whisker_args = list(size = 2, color=customblue),
       vline = geom_vline(
           xintercept = 0,
           colour = "grey6",
           linetype = 2
       ),
       vars_order = c("rainnovmay", "rainnovapr", "rainnovmar", "rainnovfeb", "rainnovjan", "rainnovdec"),
       model_order = c("Model 12B", "Model 11B", "Model 10B", "Model 9B", "Model 8B", "Model 7B")
       ) %>% # plot line at zero _behind_coefs
    relabel_predictors(
        c(
            rainnovmay = "Nov-May",
            rainnovapr = "Nov-Apr",
            rainnovmar = "Nov-Mar",
            rainnovfeb = "Nov-Feb",
            rainnovjan = "Nov-Jan",
            rainnovdec = "Nov-Dec"
        )
    ) + coord_flip() +
    # Setting `base_size` for fit the theme
    # No need to set `base_size` in most usage
    xlab("Coefficient Estimate") + ylab("Rainfall (100 mm)") +
    geom_vline(xintercept = 0,
               colour = "grey6",
               linetype = 2) +
    ggtitle("Fig. 2B: OLS Estimation Of Rural Poverty Gap, M1, (adjusted) Using Precipitation") + theme_bw() +
    theme(
          legend.position = "none", plot.title = element_text(size = 12)
    ) 

```


```{r}
model13b <- lm(m2_k3_adj_rural ~ yeard + rainnovdec, data = datareg)
model14b <- lm(m2_k3_adj_rural ~ yeard + rainnovjan, data = datareg)
model15b <- lm(m2_k3_adj_rural ~ yeard + rainnovfeb, data = datareg)
model16b <- lm(m2_k3_adj_rural ~ yeard + rainnovmar, data = datareg)
model17b <- lm(m2_k3_adj_rural ~ yeard + rainnovapr, data = datareg)
model18b <- lm(m2_k3_adj_rural ~ yeard + rainnovmay, data = datareg)

summary(model13b) 
summary(model14b)
summary(model15b)
summary(model16b)
summary(model17b)
summary(model18b)
```

```{r}
m13b_df <-
    broom::tidy(model13b) %>% filter(term != "yeard") %>% mutate(model = "Model 13B")
m14b_df <-
    broom::tidy(model14b) %>% filter(term != "yeard") %>% mutate(model = "Model 14B")
m15b_df <-
    broom::tidy(model15b) %>% filter(term != "yeard") %>% mutate(model = "Model 15B")
m16b_df <-
    broom::tidy(model16b) %>% filter(term != "yeard") %>% mutate(model = "Model 16B")
m17b_df <-
    broom::tidy(model17b) %>% filter(term != "yeard") %>% mutate(model = "Model 17B")
m18b_df <-
    broom::tidy(model18b) %>% filter(term != "yeard") %>% mutate(model = "Model 18B")

m2_models_b <- rbind(m13b_df, m14b_df, m15b_df, m16b_df, m17b_df, m18b_df)

```


```{r plot_pptm2adjr}
dwplot(m2_models_b, dodge_size = 0, dot_args = list(size = 5, color=customblue), whisker_args = list(size = 2, color=customblue),
       vline = geom_vline(
           xintercept = 0,
           colour = "grey6",
           linetype = 2
       ),
       vars_order = c("rainnovmay", "rainnovapr", "rainnovmar", "rainnovfeb", "rainnovjan", "rainnovdec"),
       model_order = c("Model 18B", "Model 17B", "Model 16B", "Model 15B", "Model 14B", "Model 13B")
       ) %>% # plot line at zero _behind_coefs
    relabel_predictors(
        c(
            rainnovmay = "Nov-May",
            rainnovapr = "Nov-Apr",
            rainnovmar = "Nov-Mar",
            rainnovfeb = "Nov-Feb",
            rainnovjan = "Nov-Jan",
            rainnovdec = "Nov-Dec"
        )
    ) + coord_flip() +
    # Setting `base_size` for fit the theme
    # No need to set `base_size` in most usage
    xlab("Coefficient Estimate") + ylab("Rainfall (100 mm)") +
    geom_vline(xintercept = 0,
               colour = "grey6",
               linetype = 2) +
    ggtitle("Fig. 3B: OLS Estimation Of Rural Squared Poverty Gap, M2, (adjusted) Using Precipitation") + theme_bw() +
    theme(
          legend.position = "none", plot.title = element_text(size = 12)
    ) 

```